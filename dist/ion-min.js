function randomNumber(e,t,r){var a=Math.random()*(t-e)+e;if(!r)var a=Math.floor(a);return a}function randomRGBA(){return"rgba("+randomNumber(0,255)+","+randomNumber(0,255)+","+randomNumber(.255)+","+randomNumber(0,1,!0)+")"}function convertHex(e,t){return e=e.replace("#",""),r=parseInt(e.substring(0,2),16),g=parseInt(e.substring(2,4),16),b=parseInt(e.substring(4,6),16),t||(t=1),result="rgba("+r+","+g+","+b+","+t/100+")",result}function colorArray(e){return e.match(/(\d{1,4})/g)}function rgbaString(e){return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"}function isColor(e){return e.match(/(#(\d|[a-f]|[A-F]){6})|(rgba\((\d{1,3},\s?){3}\d?\.?\d{1}\))/g).length>0}function getAbsValue(e){var t=Math.abs(parseFloat(e));return e.match("-")&&(t=-t),t}function decimalPlaces(e){var t=(""+e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return t?Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0)):0}function defaultOptions(e,t){if("object"==typeof t)for(var r in e)void 0!=t[r]&&(e[r]=t[r]);return e}var Particle=function(e,t){var r=this;r.ion=t,r.init(e),r.draw()};Particle.prototype.setProperty=function(e){var t=this,r=e.value,a=e.property;"random"==r?e.acceptedValues?t[a]=e.acceptedValues[randomNumber(0,e.acceptedValues.length)]:"color"==e.randomize?t[a]=randomRGBA():t[a]=randomNumber(randomize[0],randomize[1],!0):isArray(r)?r.length>2?t[a]=r[randomNumber(0,r.length)]:t[a]=randomNumber(r[0],r[1],!0):r?t[a]=r:t[a]=!1},Particle.prototype.colorFormat=function(){var e=this,t=100*e.colorOpacity||100,r=100*e.strokeOpacity||100;e.color.indexOf(!1)&&(e.color=convertHex(e.color,t)),e.colorArray=colorArray(e.color),e.colorOpacity&&(e.colorArray[3]=e.colorOpacity),e.strokeColor.indexOf("#")>=0&&(e.strokeColor=convertHex(e.strokeColor,r)),e.strokeColorArray=colorArray(e.strokeColor),e.strokeOpacity&&(e.strokeColorArray[3]=e.strokeOpacity)},Particle.prototype.init=function(e){var t=this;e.opacity||1;switch(t.setProperty({property:"death",value:e.death,randomize:[500,3e3]}),t.life=0,t.setProperty({property:"color",value:e.color,randomize:"color"}),t.setProperty({property:"colorOpacity",value:e.colorOpacity,randomize:[0,1]}),t.setProperty({property:"strokeColor",value:e.strokeColor,randomize:"color"}),t.setProperty({property:"strokeWidth",value:e.strokeWidth,randomize:[0,10]}),t.setProperty({property:"strokeOpacity",value:e.strokeOpacity,randomize:[0,1]}),t.colorFormat(),t.setProperty({property:"size",value:e.size,randomize:[1,.5*t.ion.canvas.width]}),t.setProperty({property:"shape",value:e.shape,acceptedValues:Object.keys(t.ion.shapes)}),t.setProperty({property:"orient",value:e.orient,randomize:[0,360]}),t.setProperty({property:"gravity",value:e.gravity,randomize:[-5,5]}),t.setProperty({property:"wind",value:e.wind,randomize:[-5,5]}),t.setProperty({property:"fade",value:e.fade,acceptedValues:["in","out","in-out"]}),t.setProperty({property:"fadeRate",value:e.fadeRate,randomize:[5,20]}),t.fade?(t.fadeStop=!1,t.colorOpacityFadeIncrement=t.colorArray[3]/(100/t.fadeRate),t.strokeOpacityFadeIncrement=t.strokeColorArray[3]/(100/t.fadeRate),t.fade.indexOf("in")>=0?(t.opacity=0,t.colorArray[3]=0,t.strokeColorArray[3]=0):t.opacity=100):t.opacity=100,e.origin[0]){case"left":t.x=2*-t.size;break;case"right":t.x=ion.canvas.width+2*t.size;break;case"center":t.x=.5*ion.canvas.width;break;case"random":t.x=Math.floor(randomNumber(2*-t.size,t.ion.canvas.width+2*t.size));break;default:t.x=e.origin[0]}switch(e.origin[1]){case"top":t.y=2*-t.size;break;case"bottom":t.y=ion.canvas.height+2*t.size;break;case"center":t.y=.5*ion.canvas.height;break;case"random":var r=2*-t.size,a=t.ion.canvas.height+2*t.size;t.y=Math.floor(randomNumber(r,a));break;default:t.y=e.origin[1]}t.setProperty({property:"rotationDirection",value:e.rotationDirection,acceptedValues:["clockwise","counter-clockwise"]}),t.setProperty({property:"rotationVelocity",value:e.rotationVelocity,randomize:[0,10]}),t.setProperty({property:"scale",value:e.scale,acceptedValues:["grow","shrink"]}),t.setProperty({property:"scaleRate",value:e.scaleRate,randomize:[.1,3]});var o=0,i=t.ion.canvas.width;"grow"==t.scale?o=t.size:i=t.size,t.setProperty({property:"scaleLimit",value:e.scaleLimit,randomize:[o,i]}),t.ion.shapes[t.shape].init!==!1&&t.ion.shapes[t.shape].init(t,e.shapeProperties)},Particle.prototype.render=function(){var e=this,t=e.ion.context;t.fillStyle=e.color,t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeWidth,t.save(),e.ion.shapes[e.shape].draw(e),t.restore()},Particle.prototype.draw=function(){var e=this,t=e.ion,r=t.canvas,a=t.context;if(e.y+=e.gravity,e.x+=e.wind,e.life++,e.rotationVelocity>0&&("clockwise"==e.rotationDirection?e.orient+=e.rotationVelocity:e.orient-=e.rotationVelocity),"grow"==e.scale&&e.size<e.scaleLimit?e.size+=e.scaleRate:"shrink"==e.scale&&e.size>e.scaleLimit&&(e.size-=e.scaleRate),e.fade){switch(e.fade){case"in":e.opacity<100?(e.colorArray[3]+=e.colorOpacityFadeIncrement,e.strokeColorArray[3]+=e.strokeOpacityFadeIncrement,e.opacity+=e.fadeRate):e.fade=!1;break;case"out":e.opacity>0?(e.colorArray[3]=e.colorArray[3]-e.colorOpacityFadeIncrement,e.strokeColorArray[3]=e.strokeColorArray[3]-e.strokeOpacityFadeIncrement,e.opacity=e.opacity-e.fadeRate):e.fade=!1;break;case"in-out":e.opacity>=100?(e.fadeStop=!0,e.opacity=100-e.fadeRate):0==e.fadeStop&&e.opacity<100?(e.colorArray[3]+=e.colorOpacityFadeIncrement,e.strokeColorArray[3]+=e.strokeOpacityFadeIncrement,e.opacity+=e.fadeRate):1==e.fadeStop&&e.opacity>0?(e.colorArray[3]=e.colorArray[3]-e.colorOpacityFadeIncrement,e.strokeColorArray[3]=e.stokrColorArray[3]-e.strokeOpacityFadeIncrement,e.opacity-=e.colorArray[3]-e.fadeRate):e.fade=!1}e.color=rgbaString(e.colorArray),e.strokeColor=rgbaString(e.strokeColorArray)}a.clearRect(r.width,r.height,r.width,r.height),e.render(),(e.life>e.death&&0!=e.death||e.gravity>0&&e.y>r.height+2*e.size||e.gravity<0&&e.y<2*-e.size||e.wind<0&&e.x<2*-e.size||e.wind>0&&e.x>r.width+2*e.size||e.size<=0||("out"==e.fade||"in-out"==e.fade)&&e.opacity<=0||0==e.fade&&0==e.opacity)&&delete t.particleTracker[e.id]};var Ion=function(e,t,r){var a=this;a.setOptions(r),a.particleTracker={},a.particleIndex=0,a.canvas=document.getElementById(e),a.context=a.canvas.getContext("2d"),a.sizeCanvas(),window.onresize=function(){a.sizeCanvas()},a.init(),t&&(a.setParticles(t),a.start())};Ion.prototype.sizeCanvas=function(){var e=this,t=e.canvas.getAttribute("width"),r=e.canvas.getAttribute("height");t||(t=window.getComputedStyle(e.canvas.parentElement,null).width),r||(r=window.getComputedStyle(e.canvas.parentElement,null).height),e.canvas.setAttribute("width",t),e.canvas.setAttribute("height",r)},Ion.prototype.stop=function(){clearInterval(this.animate)},Ion.prototype.setParticles=function(e){var t=this;if(!e.length){var r=e;e=new Array,e.push(r)}for(var a=0;a<e.length;a++)e[a]=defaultOptions({shape:"circle",color:"rgba(0,0,0,1)",colorOpacity:1,strokeColor:"rbga(0,0,0,0)",strokeWidth:0,strokeOpacity:1,size:[10,90],rotationDirection:"clockwise",rotationVelocity:0,orient:0,death:!1,fade:!1,fadeRate:20,scale:!1,scaleRate:.2,scaleLimit:500,gravity:1,wind:1,density:20,spawnOrigin:["random","top"],origin:["random","random"],spawnRate:2,shapeProperties:!1},e[a]);t.particles=e},Ion.prototype.setOptions=function(e){var t=this;options=defaultOptions({frameRate:30,canvasBackground:"rgba(255,255,255,1)"},e),t.frameRate=options.frameRate,t.canvasBackground=options.canvasBackground},Ion.prototype.createParticle=function(e){var t=new Particle(e,this);this.particleTracker[this.particleIndex]=t,t.id=this.particleIndex,this.particleIndex++},Ion.prototype.addShape=function(e){this.shapes[e.name].draw=e.drawingInstructions,this.shapes[e.name].init=e.init},Ion.prototype.init=function(){this.shapes={circle:{draw:drawCircle,init:!1},square:{draw:drawSquare,init:!1},triangle:{draw:drawTriangle,init:!1},star:{draw:drawStar,init:initStar}}},Ion.prototype.start=function(){for(var e=this,t=0;t<e.particles.length;t++)for(var r=e.particles[t],a=0;a<r.density;a++)e.createParticle(r);e.animate=setInterval(function(){e.context.fillStyle=e.canvasBackground,e.context.fillRect(0,0,e.canvas.width,e.canvas.height);for(var t=0;t<e.particles.length;t++){var r=e.particles[t];r.origin=r.spawnOrigin,r.spawnRate>0&&randomNumber(0,25*r.density)<r.spawnRate&&e.createParticle(r)}for(var a in e.particleTracker)e.particleTracker[a].draw()},e.frameRate)};var drawCircle=function(e){var t=e.ion.context;t.translate(e.x,e.y),t.moveTo(e.x,e.y),t.beginPath(),t.arc(0,0,.5*e.size,0,2*Math.PI,!0),t.fill(),e.strokeWidth&&t.stroke(),t.closePath()},drawSquare=function(e){var t=e.ion.context;t.translate(e.x,e.y),t.moveTo(0,0),e.orient&&t.rotate(e.orient*Math.PI/180),t.moveTo(e.x-.5*e.size,e.y-.5*e.size),t.beginPath(),t.rect(.5*-e.size,.5*-e.size,e.size,e.size),t.fill(),e.strokeWidth&&t.stroke(),t.closePath()},initStar=function(e,t){polygonPoints=t.polygonPoints||5,starGirth=t.starGirth||.5,e.setProperty({property:"polygonPoints",value:polygonPoints,acceptedValues:[3,4,5,6,7,8,9,10,11,12]}),e.setProperty({property:"starGirth",value:starGirth,randomize:[.05,1]}),e.starAngle=2*Math.PI/e.polygonPoints},drawStar=function(e){var t=e.ion.context,r=new Array;for(i=1;i<=e.polygonPoints;i++){var a=[0+e.size*Math.cos(e.starAngle*i-2*Math.PI*.2),0+e.size*Math.sin(e.starAngle*i-2*Math.PI*.2)],o=[0+e.size*e.starGirth*Math.cos(e.starAngle*(i-1)+.5*e.starAngle-2*Math.PI*.2),0+e.size*e.starGirth*Math.sin(e.starAngle*(i-1)+.5*e.starAngle-2*Math.PI*.2)];r.push(o),r.push(a)}t.translate(e.x,e.y),t.moveTo(0,0),e.orient&&t.rotate(e.orient*Math.PI/180),t.moveTo(r[0][0],r[0][1]),t.beginPath();for(var n=1;n<r.length;n++)t.lineTo(r[n][0],r[n][1]);t.lineTo(r[0][0],r[0][1]),t.closePath(),e.strokeWidth&&t.stroke(),t.fill()},drawTriangle=function(e){var t=e.ion.context;t.translate(e.x,e.y),t.moveTo(e.x,e.y),e.orient&&t.rotate(e.orient*Math.PI/180),t.moveTo(e.x,e.y),t.beginPath(),t.lineTo(.5*e.size,.5*e.size),t.lineTo(.5*-e.size,.5*e.size),t.lineTo(0,.4*-e.size),t.closePath(),t.fill(),e.strokeWidth&&t.stroke()};isArray=function(e){return"[object Array]"==Object.prototype.toString.call(e)};