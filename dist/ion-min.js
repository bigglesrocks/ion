var drawCircle=function(p){var ctx=p.ion.context;p.ion.randomNumber(p.minSize,p.maxSize);ctx.translate(p.x,p.y),ctx.moveTo(p.x,p.y),ctx.beginPath(),ctx.arc(30,30,p.size,0,2*Math.PI,!0),ctx.fill(),p.borderWidth&&ctx.stroke(),ctx.closePath()},drawSquare=function(p){var ctx=p.ion.context;ctx.translate(p.x,p.y),p.rotation&&(ctx.rotate(p.orient+p.rotationVelocity),p.orient++),ctx.moveTo(p.x,p.y),ctx.beginPath(),ctx.rect(0,0,p.size,p.size),ctx.fill(),p.borderWidth&&ctx.stroke(),ctx.closePath()},Particle=function(particleOptions,ion){var o=particleOptions,particle=this;switch(particle.ion=ion,particle.opacity=1,particle.shape=o.shape,particle.color=o.color,particle.borderColor=o.borderColor,particle.borderWidth=o.borderWidth,particle.minSize=o.minSize,particle.maxSize=o.maxSize,particle.rotationDirection=o.rotationDirection,particle.rotationVelocity=o.rotationVelocity,particle.gravity=o.gravity,particle.grow=o.grow,particle.composite=o.composite,particle.fadeSpeed=o.fadeSpeed,particle.fade=o.fade,particle.spawnRate=o.spawnRate,particle.orient=o.orient,particle.colorArray=particle.color.match(/(\d{1,4})/g),"in-out"==particle.fade&&(particle.fade="in",particle.fadeStop=!1),"flux"==particle.shape?particle.order=1:particle.order=0,particle.x=Math.floor(particle.ion.randomNumber(-100,particle.ion.canvas.width+100)),particle.y=Math.floor(particle.ion.randomNumber(-100,particle.ion.canvas.height+100)),particle.size=Math.floor(particle.ion.randomNumber(particle.minSize,particle.maxSize)),particle.rotationDirection){case"clockwise":particle.rotation=.01*particle.rotationVelocity;break;case"counter-clockwise":particle.rotation=.01*-particle.rotationVelocity;break;case"random":var chance=ion.randomNumber(0,100);chance>50?particle.rotation=.01*particle.rotationVelocity:particle.rotation=.01*particle.roationVelocity}particle.life=0,particle.maxLife=o.maxLife,particle.draw()};Particle.prototype.render=function(shape){var particle=this,context=particle.ion.context;context.fillStyle=particle.color,context.strokeStyle=particle.borderColor,context.lineWidth=particle.borderWidth,context.save(),particle.ion.shapes[shape](particle),context.restore()},Particle.prototype.draw=function(){var particle=this,ion=particle.ion,canvas=ion.canvas,context=ion.context;if(particle.y+=particle.gravity*Math.floor(particle.ion.randomNumber(1,2)),particle.life++,"clockwise"==particle.rotationDirection?particle.rotation+=particle.rotationVelocity:particle.rotation-=particle.rotationVelocity,particle.grow&&(particle.size=particle.size*particle.grow),particle.fade){switch(particle.fadeStop===!1&&particle.opacity>=1&&(particle.fade="out"),particle.fade){case"in":particle.opacity=particle.opacity+particle.fadeSpeed;break;case"out":particle.opacity=particle.opacity-particle.fadeSpeed}particle.color="rgba("+particle.colorArray[0]+","+particle.colorArray[1]+","+particle.colorArray[2]+","+particle.opacity+")"}context.clearRect(canvas.width,canvas.height,canvas.width,canvas.height),context.fillStyle=particle.color,particle.render(particle.shape,particle.x,particle.y,particle.size,particle.size,particle.rotation,particle.color,particle.rotationDirection),particle.life>particle.maxLife&&delete ion.particleTracker[particle.id]};var Ion=function(el,particles,options){var ion=this;ion.setOpts=function(standard,user){if("object"==typeof user)for(var key in standard)null!=user[key]&&(standard[key]=user[key]);return standard},ion.randomNumber=function(min,max,frac){var num=Math.random()*(max-min)+min;if(!frac)var num=Math.floor(num);return num},ion.setOptions(options),ion.particleTracker={},ion.particleIndex=0,ion.canvas=document.getElementById(el),ion.context=ion.canvas.getContext("2d"),ion.sizeCanvas(),window.onresize=function(){ion.sizeCanvas()},ion.init(),particles&&(ion.setParticles(particles),ion.start())};Ion.prototype.sizeCanvas=function(){var ion=this,width=ion.canvas.getAttribute("width"),height=ion.canvas.getAttribute("height");width||(width=window.getComputedStyle(ion.canvas.parentElement,null).width),height||(height=window.getComputedStyle(ion.canvas.parentElement,null).height),ion.canvas.setAttribute("width",width),ion.canvas.setAttribute("height",height)},Ion.prototype.stop=function(){clearInterval(this.animate)},Ion.prototype.setParticles=function(particles){var ion=this;if("object"==typeof particles){var particle=particles;particles=new Array,particles.push(particle)}for(var p=0;p<particles.length;p++)particles[p]=ion.setOpts({shape:"circle",color:"rgba(0,0,0,1)",borderColor:"rbga(0,0,0,0)",borderWidth:0,minSize:15,maxSize:30,rotationDirection:"clockwise",rotationVelocity:.1,orient:0,spawnRate:8,maxLife:100,fade:!1,fadeSpeed:.01,grow:!1,gravity:1,wind:1,density:20},particles[p]);ion.particles=particles},Ion.prototype.setOptions=function(opts){var ion=this;options=ion.setOpts({frameRate:30,canvasBackground:"rgba(255,255,255,1)"},opts),ion.frameRate=options.frameRate,ion.canvasBackground=options.canvasBackground},Ion.prototype.createParticle=function(par){var particle=new Particle(par,this);this.particleTracker[this.particleIndex]=particle,particle.id=this.particleIndex,this.particleIndex++},Ion.prototype.addShape=function(id,instructions){this.shapes[id]=instructions},Ion.prototype.init=function(){this.shapes={circle:drawCircle,square:drawSquare}},Ion.prototype.start=function(){for(var ion=this,t=0;t<ion.particles.length;t++)for(var par=ion.particles[t],d=0;d<par.density;d++)ion.createParticle(par);ion.animate=setInterval(function(){ion.context.fillStyle=ion.canvasBackground,ion.context.fillRect(0,0,ion.canvas.width,ion.canvas.height);for(var s=0;s<ion.particles.length;s++){var par=ion.particles[s];par.spawnRate>0&&ion.randomNumber(0,100)<par.spawnRate&&ion.createParticle(par)}for(var p in ion.particleTracker)ion.particleTracker[p].draw()},ion.frameRate)};